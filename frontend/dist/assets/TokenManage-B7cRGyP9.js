import{r as i,j as h,c as ee,o as p,b as a,w as l,d as r,ac as le,E as d,P as ae,a as f,f as x,V as te,i as s,R as oe,B as k,ad as ne,t as D,ae as se,T as re,af as de,s as I,$ as ie,ag as ue,ah as me,ai as pe}from"./index-BaHTuV22.js";import{_ as fe}from"./_plugin-vue_export-helper-DlAUqK2U.js";const ke={class:"token-manage-view"},ve={class:"header-content"},ce={class:"token-name"},_e={class:"token-display"},ye={__name:"TokenManage",setup(Te){const B=i(!1),v=i(!1),U=i([]),c=i(!1),w=i(!1),g=i(!1),V=i(""),M=i(null),$=i(null),m=i({name:"",expiresIn:"30d"}),P={name:[{required:!0,message:"请输入备注",trigger:"blur"}],expiresIn:[{required:!0,message:"请选择有效期",trigger:"change"}]},_=i({id:null,name:""}),Y={name:[{required:!0,message:"请输入备注",trigger:"blur"}]},C=async()=>{B.value=!0;try{const o=await le();U.value=Array.isArray(o.data)?o.data:[]}catch(o){console.error("Failed to fetch token list:",o),d.error("获取 Token 列表失败")}finally{B.value=!1}},q=async()=>{var o,e;if(M.value)try{await M.value.validate(),v.value=!0;const n=await me(m.value.name,m.value.expiresIn);n.data&&n.data.token?(d.success("Token 创建成功"),V.value=n.data.token,c.value=!1,w.value=!0,m.value={name:"",expiresIn:"30d"},C()):d.error("Token 创建失败")}catch(n){console.error("Token creation failed:",n),d.error(((e=(o=n.response)==null?void 0:o.data)==null?void 0:e.detail)||"Token 创建失败")}finally{v.value=!1}},L=o=>{_.value={id:o.id,name:o.name},g.value=!0},N=async()=>{var o,e;if($.value)try{await $.value.validate(),v.value=!0;const n=await pe(_.value.id,_.value.name);n.data&&n.data.id?(d.success("Token 更新成功"),g.value=!1,C()):d.error("Token 更新失败")}catch(n){console.error("Token update failed:",n),d.error(((e=(o=n.response)==null?void 0:o.data)==null?void 0:e.detail)||"Token 更新失败")}finally{v.value=!1}},j=async o=>{var e,n;try{await ie.confirm(`确定要撤销 Token "${o.name}"吗？撤销后该 Token 将无法再使用。`,"撤销 Token",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"});const u=await ue(o.id);u.data&&u.data.id?(d.success("Token 已撤销"),C()):d.error("Token 撤销失败")}catch(u){u!=="cancel"&&(console.error("Token deletion failed:",u),d.error(((n=(e=u.response)==null?void 0:e.data)==null?void 0:n.detail)||"Token 撤销失败"))}},S=async()=>{try{await navigator.clipboard.writeText(V.value),d.success("Token 已复制到剪贴板")}catch(o){console.error("Failed to copy token:",o),d.error("复制失败，请手动复制")}},R=o=>o?I(o).format("YYYY-MM-DD HH:mm"):"-",A=o=>o?I(o).isBefore(I()):!1,G=o=>o?I(o).format("MM-DD HH:mm"):"永久";return h(()=>{C()}),(o,e)=>{const n=r("el-button"),u=r("el-card"),J=r("el-icon"),y=r("el-table-column"),T=r("el-tag"),K=r("el-empty"),O=r("el-table"),z=r("el-input"),E=r("el-form-item"),b=r("el-option"),Q=r("el-select"),H=r("el-form"),F=r("el-dialog"),W=r("el-alert"),X=ae("loading");return p(),ee("div",ke,[a(u,{shadow:"never",class:"header-card"},{default:l(()=>[f("div",ve,[e[13]||(e[13]=f("div",{class:"header-left"},[f("h2",{class:"page-title"},"API Token 管理"),f("p",{class:"page-desc"},"管理您的 API Token，用于系统访问认证")],-1)),a(n,{type:"primary",icon:x(te),onClick:e[0]||(e[0]=t=>c.value=!0)},{default:l(()=>[...e[12]||(e[12]=[s(" 创建 Token ",-1)])]),_:1},8,["icon"])])]),_:1}),a(u,{shadow:"never",class:"table-card"},{default:l(()=>[oe((p(),k(O,{data:U.value,stripe:"",style:{width:"100%"}},{empty:l(()=>[a(K,{description:"暂无 Token"},{default:l(()=>[a(n,{type:"primary",onClick:e[1]||(e[1]=t=>c.value=!0)},{default:l(()=>[...e[21]||(e[21]=[s(" 创建第一个 Token ",-1)])]),_:1})]),_:1})]),default:l(()=>[a(y,{label:"备注",prop:"name","min-width":"150"},{default:l(({row:t})=>[f("div",ce,[a(J,{class:"mr-1"},{default:l(()=>[a(x(ne))]),_:1}),s(" "+D(t.name||"未命名"),1)])]),_:1}),a(y,{label:"有效期",prop:"expires_at",width:"120"},{default:l(({row:t})=>[t.expires_at?A(t.expires_at)?(p(),k(T,{key:1,type:"danger",size:"small"},{default:l(()=>[...e[15]||(e[15]=[s(" 已过期 ",-1)])]),_:1})):(p(),k(T,{key:2,type:"info",size:"small"},{default:l(()=>[s(D(G(t.expires_at)),1)]),_:2},1024)):(p(),k(T,{key:0,type:"success",size:"small"},{default:l(()=>[...e[14]||(e[14]=[s(" 永久有效 ",-1)])]),_:1}))]),_:1}),a(y,{label:"创建时间",prop:"created_at",width:"160"},{default:l(({row:t})=>[s(D(R(t.created_at)),1)]),_:1}),a(y,{label:"最后使用",prop:"last_used_at",width:"160"},{default:l(({row:t})=>[s(D(t.last_used_at?R(t.last_used_at):"从未使用"),1)]),_:1}),a(y,{label:"状态",prop:"status",width:"100"},{default:l(({row:t})=>[t.expires_at&&A(t.expires_at)?(p(),k(T,{key:0,type:"danger",size:"small"},{default:l(()=>[...e[16]||(e[16]=[s("已过期",-1)])]),_:1})):t.is_revoked?(p(),k(T,{key:1,type:"info",size:"small"},{default:l(()=>[...e[17]||(e[17]=[s("已撤销",-1)])]),_:1})):(p(),k(T,{key:2,type:"success",size:"small"},{default:l(()=>[...e[18]||(e[18]=[s("正常",-1)])]),_:1}))]),_:1}),a(y,{label:"操作",width:"180",fixed:"right"},{default:l(({row:t})=>[a(n,{link:"",type:"primary",size:"small",icon:x(se),onClick:Z=>L(t)},{default:l(()=>[...e[19]||(e[19]=[s(" 编辑 ",-1)])]),_:1},8,["icon","onClick"]),a(n,{link:"",type:"danger",size:"small",icon:x(re),disabled:t.is_revoked,onClick:Z=>j(t)},{default:l(()=>[...e[20]||(e[20]=[s(" 撤销 ",-1)])]),_:1},8,["icon","disabled","onClick"])]),_:1})]),_:1},8,["data"])),[[X,B.value]])]),_:1}),a(F,{modelValue:c.value,"onUpdate:modelValue":e[5]||(e[5]=t=>c.value=t),title:"创建 API Token",width:"500px","close-on-click-modal":!1},{footer:l(()=>[a(n,{onClick:e[4]||(e[4]=t=>c.value=!1)},{default:l(()=>[...e[22]||(e[22]=[s("取消",-1)])]),_:1}),a(n,{type:"primary",loading:v.value,onClick:q},{default:l(()=>[...e[23]||(e[23]=[s(" 创建 ",-1)])]),_:1},8,["loading"])]),default:l(()=>[a(H,{ref_key:"createFormRef",ref:M,model:m.value,rules:P,"label-width":"80px"},{default:l(()=>[a(E,{label:"备注",prop:"name"},{default:l(()=>[a(z,{modelValue:m.value.name,"onUpdate:modelValue":e[2]||(e[2]=t=>m.value.name=t),placeholder:"请输入备注，便于识别",clearable:""},null,8,["modelValue"])]),_:1}),a(E,{label:"有效期",prop:"expiresIn"},{default:l(()=>[a(Q,{modelValue:m.value.expiresIn,"onUpdate:modelValue":e[3]||(e[3]=t=>m.value.expiresIn=t),style:{width:"100%"}},{default:l(()=>[a(b,{label:"1 天",value:"1d"}),a(b,{label:"7 天",value:"7d"}),a(b,{label:"30 天",value:"30d"}),a(b,{label:"90 天",value:"90d"}),a(b,{label:"永久有效",value:"forever"})]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"]),a(F,{modelValue:w.value,"onUpdate:modelValue":e[8]||(e[8]=t=>w.value=t),title:"Token 创建成功",width:"600px","close-on-click-modal":!1},{footer:l(()=>[a(n,{type:"primary",onClick:e[7]||(e[7]=t=>w.value=!1)},{default:l(()=>[...e[27]||(e[27]=[s(" 我已保存 ",-1)])]),_:1})]),default:l(()=>[a(W,{type:"warning",closable:!1,"show-icon":""},{title:l(()=>[...e[24]||(e[24]=[f("div",{class:"alert-title"},"请立即复制保存您的 Token",-1)])]),default:l(()=>[e[25]||(e[25]=f("div",{class:"alert-desc"}," 出于安全考虑，Token 只会显示一次，关闭后将无法再次查看。 ",-1))]),_:1}),f("div",_e,[a(z,{modelValue:V.value,"onUpdate:modelValue":e[6]||(e[6]=t=>V.value=t),type:"textarea",rows:4,readonly:"",class:"token-textarea"},null,8,["modelValue"]),a(n,{type:"primary",icon:x(de),class:"copy-button",onClick:S},{default:l(()=>[...e[26]||(e[26]=[s(" 复制 Token ",-1)])]),_:1},8,["icon"])])]),_:1},8,["modelValue"]),a(F,{modelValue:g.value,"onUpdate:modelValue":e[11]||(e[11]=t=>g.value=t),title:"编辑 Token",width:"500px","close-on-click-modal":!1},{footer:l(()=>[a(n,{onClick:e[10]||(e[10]=t=>g.value=!1)},{default:l(()=>[...e[28]||(e[28]=[s("取消",-1)])]),_:1}),a(n,{type:"primary",loading:v.value,onClick:N},{default:l(()=>[...e[29]||(e[29]=[s(" 保存 ",-1)])]),_:1},8,["loading"])]),default:l(()=>[a(H,{ref_key:"editFormRef",ref:$,model:_.value,rules:Y,"label-width":"80px"},{default:l(()=>[a(E,{label:"备注",prop:"name"},{default:l(()=>[a(z,{modelValue:_.value.name,"onUpdate:modelValue":e[9]||(e[9]=t=>_.value.name=t),placeholder:"请输入备注",clearable:""},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"])])}}},xe=fe(ye,[["__scopeId","data-v-4314cab6"]]);export{xe as default};
