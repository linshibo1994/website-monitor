import{r as g,N as Ve,j as Ce,O as ze,c as y,o as u,b as t,w as a,d as o,n as xe,P as Se,a as n,f,Q as Ie,t as c,A as Ue,B as w,C as J,D as O,z as Te,F as Pe,i as d,R as De,H as U,I as T,J as P,S as Le,T as Be,U as Ne,V as Xe,W as Ae,X as Me,Y as $e,E as h,Z as Ee,_ as Fe,$ as Ke,a0 as Re,a1 as je,a2 as We,a3 as He}from"./index-BaHTuV22.js";import{_ as Je}from"./_plugin-vue_export-helper-DlAUqK2U.js";const Oe={class:"inventory-view"},Qe={class:"stat-card"},Ye={class:"icon-wrapper bg-blue"},Ze={class:"content"},qe={class:"value"},Ge={class:"stat-card"},et={class:"content"},tt={class:"value"},at={class:"stat-card"},lt={class:"icon-wrapper bg-purple"},st={class:"content"},nt={class:"value"},ot={class:"card-header"},rt={class:"header-title"},it={class:"variants-container"},ut={key:0,class:"coming-soon-alert"},dt={class:"product-name-cell"},ct={class:"name-text"},_t={class:"tags-wrapper"},pt={key:0,class:"text-gray"},vt={class:"text-gray"},ft={class:"tab-content"},mt={key:0,class:"parse-success-card"},gt={class:"header"},yt={class:"info-grid"},bt={class:"item"},ht={class:"item"},kt={key:0,class:"item full"},wt={class:"preview-link"},Vt={key:1,class:"parse-error-msg"},Ct={key:0,class:"color-hint"},zt={__name:"Inventory",setup(xt){const m=g({is_running:!1,last_check_time:null,monitored_products:0,products:[]}),D=g(!1),L=g(!1),B=g(!1),C=g(!1),N=g("smart"),V=g([]),S=g(!1);let X=null;const r=g({input:"",name:"",category:"",target_sizes:[],target_colors:[]}),p=g({success:!1,error:null}),A=g("");let M=null;const Q=Ve(()=>N.value==="manual"?!!r.value.input:p.value.success||r.value.input&&!p.value.error),z=async()=>{try{const l=await xe();m.value=l.data}catch(l){console.error(l)}},E=async()=>{var l,e;L.value=!0;try{const _=await $e();h.success(`检查完成: 变动 ${_.data.changes_detected}`),await z()}catch(_){h.error(((e=(l=_.response)==null?void 0:l.data)==null?void 0:e.detail)||"检查失败")}finally{L.value=!1}},Y=async()=>{try{m.value.is_running?(await Ee(),h.success("监控已停止")):(await Fe(),h.success("监控已启动")),await z()}catch{h.error("操作失败")}},Z=()=>{M&&clearTimeout(M),M=setTimeout(q,500)},q=async()=>{var e,_;const l=r.value.input.trim();if(V.value=[],!l){p.value={success:!1,error:null};return}try{const v=await We(l);p.value=v.data,v.data.success&&(A.value=v.data.url,v.data.category&&(r.value.category=v.data.category),v.data.url&&G(v.data.url))}catch(v){p.value={success:!1,error:((_=(e=v.response)==null?void 0:e.data)==null?void 0:_.detail)||"无法解析"}}},G=async l=>{S.value=!0;try{const e=await He(l);e.data.success&&e.data.colors&&(V.value=e.data.colors)}catch(e){console.error("获取颜色失败:",e),V.value=[]}finally{S.value=!1}},ee=()=>{},te=async()=>{var l,e;B.value=!0;try{await je({input:r.value.input,name:r.value.name,category:r.value.category,target_sizes:r.value.target_sizes,target_colors:r.value.target_colors}),h.success("添加成功"),C.value=!1,E()}catch(_){h.error(((e=(l=_.response)==null?void 0:l.data)==null?void 0:e.detail)||"添加失败")}finally{B.value=!1}},ae=async l=>{try{await Ke.confirm("确定移除该商品吗?","警告",{type:"warning"}),await Re(l),h.success("已移除"),z()}catch{}},le=l=>window.open(l,"_blank"),F=l=>l?new Date(l).toLocaleString("zh-CN",{month:"numeric",day:"numeric",hour:"2-digit",minute:"2-digit"}):"从未",se=l=>l.includes("scheels")?"Scheels":l.includes("arcteryx")?"Arc'teryx":"Site",ne=(l,e)=>!e||!e.length?!0:e.includes(l),oe=l=>!l.variants||!l.variants.length?[]:!l.target_colors||!l.target_colors.length?l.variants:l.variants.filter(e=>e.color_name&&l.target_colors.includes(e.color_name)),re=l=>({available:"success",coming_soon:"warning",unavailable:"danger"})[l]||"info",ie=l=>({available:"现货",coming_soon:"即将上架",unavailable:"缺货"})[l]||l,ue=()=>{r.value={input:"",name:"",category:"",target_sizes:[],target_colors:[]},p.value={success:!1},V.value=[],C.value=!0},de=()=>{};return Ce(()=>{D.value=!0,z().finally(()=>D.value=!1),X=setInterval(z,3e4)}),ze(()=>{X&&clearInterval(X)}),(l,e)=>{const _=o("el-icon"),v=o("el-col"),k=o("el-button"),ce=o("el-row"),_e=o("el-alert"),x=o("el-tag"),b=o("el-table-column"),K=o("el-table"),pe=o("el-button-group"),ve=o("el-empty"),fe=o("el-card"),$=o("el-input"),me=o("el-radio-button"),ge=o("el-radio-group"),ye=o("el-link"),R=o("el-tab-pane"),I=o("el-form-item"),j=o("el-form"),be=o("el-tabs"),he=o("el-divider"),W=o("el-option"),H=o("el-select"),ke=o("el-dialog"),we=Se("loading");return u(),y("div",Oe,[t(ce,{gutter:20,class:"overview-row"},{default:a(()=>[t(v,{span:6},{default:a(()=>[n("div",Qe,[n("div",Ye,[t(_,null,{default:a(()=>[t(f(Ie))]),_:1})]),n("div",Ze,[n("div",qe,c(m.value.monitored_products),1),e[9]||(e[9]=n("div",{class:"label"},"监控商品",-1))])])]),_:1}),t(v,{span:6},{default:a(()=>[n("div",Ge,[n("div",{class:Ue(["icon-wrapper",m.value.is_running?"bg-green":"bg-red"])},[m.value.is_running?(u(),w(_,{key:0},{default:a(()=>[t(f(J))]),_:1})):(u(),w(_,{key:1},{default:a(()=>[t(f(O))]),_:1}))],2),n("div",et,[n("div",tt,c(m.value.is_running?"运行中":"已停止"),1),e[10]||(e[10]=n("div",{class:"label"},"监控状态",-1))])])]),_:1}),t(v,{span:6},{default:a(()=>[n("div",at,[n("div",lt,[t(_,null,{default:a(()=>[t(f(Te))]),_:1})]),n("div",st,[n("div",nt,c(F(m.value.last_check_time)),1),e[11]||(e[11]=n("div",{class:"label"},"上次检查",-1))])])]),_:1}),t(v,{span:6,class:"actions-col"},{default:a(()=>[t(k,{type:"primary",loading:L.value,onClick:E,icon:f(Pe),class:"action-btn"},{default:a(()=>[...e[12]||(e[12]=[d(" 立即检查 ",-1)])]),_:1},8,["loading","icon"]),t(k,{type:m.value.is_running?"danger":"success",onClick:Y,icon:m.value.is_running?f(O):f(J),class:"action-btn",plain:""},{default:a(()=>[d(c(m.value.is_running?"停止":"启动"),1)]),_:1},8,["type","icon"])]),_:1})]),_:1}),t(fe,{class:"table-card",shadow:"never"},{header:a(()=>[n("div",ot,[n("div",rt,[t(_,null,{default:a(()=>[t(f(Ne))]),_:1}),e[13]||(e[13]=n("span",null,"监控列表",-1))]),t(k,{type:"primary",icon:f(Xe),onClick:ue},{default:a(()=>[...e[14]||(e[14]=[d(" 添加商品 ",-1)])]),_:1},8,["icon"])])]),default:a(()=>[De((u(),w(K,{data:m.value.products,style:{width:"100%"},"row-key":"url"},{empty:a(()=>[t(ve,{description:"暂无监控商品"})]),default:a(()=>[t(b,{type:"expand"},{default:a(s=>[n("div",it,[s.row.status==="coming_soon"?(u(),y("div",ut,[t(_e,{title:"商品即将上架",type:"warning",description:"该商品目前标记为即将上架，正在持续监控中。","show-icon":"",closable:!1})])):(u(),w(K,{key:1,data:oe(s.row),size:"small",border:""},{default:a(()=>[t(b,{prop:"size",label:"尺码",width:"120",align:"center"},{default:a(({row:i})=>[t(x,{type:ne(i.size,s.row.target_sizes)?"warning":"info",size:"small"},{default:a(()=>[d(c(i.size),1)]),_:2},1032,["type"])]),_:2},1024),t(b,{prop:"color_name",label:"颜色",width:"180","show-overflow-tooltip":""}),t(b,{prop:"stock_status",label:"库存状态",align:"center"},{default:a(({row:i})=>[t(x,{type:i.is_available?"success":"danger",effect:"dark",size:"small"},{default:a(()=>[d(c(i.is_available?"有货":"缺货"),1)]),_:2},1032,["type"])]),_:1})]),_:2},1032,["data"]))])]),_:1}),t(b,{prop:"name",label:"商品名称","min-width":"200"},{default:a(({row:s})=>[n("div",dt,[n("span",ct,c(s.name||"正在获取..."),1),t(x,{size:"small",effect:"plain",type:"info"},{default:a(()=>[d(c(se(s.url)),1)]),_:2},1024)])]),_:1}),t(b,{label:"目标",width:"200"},{default:a(({row:s})=>[n("div",_t,[(u(!0),y(T,null,P(s.target_sizes,i=>(u(),w(x,{key:i,size:"small",type:"warning",effect:"plain"},{default:a(()=>[d(c(i),1)]),_:2},1024))),128)),s.target_sizes.length?U("",!0):(u(),y("span",pt,"全尺码"))])]),_:1}),t(b,{prop:"status",label:"状态",width:"120",align:"center"},{default:a(({row:s})=>[t(x,{type:re(s.status),effect:"light"},{default:a(()=>[d(c(ie(s.status)),1)]),_:2},1032,["type"])]),_:1}),t(b,{label:"最后更新",width:"180"},{default:a(({row:s})=>[n("span",vt,c(F(s.last_check_time)),1)]),_:1}),t(b,{label:"操作",width:"150",align:"right"},{default:a(({row:s})=>[t(pe,null,{default:a(()=>[t(k,{link:"",type:"primary",icon:f(Le),onClick:i=>le(s.url)},{default:a(()=>[...e[15]||(e[15]=[d("访问",-1)])]),_:1},8,["icon","onClick"]),t(k,{link:"",type:"danger",icon:f(Be),onClick:i=>ae(s.url)},{default:a(()=>[...e[16]||(e[16]=[d("移除",-1)])]),_:1},8,["icon","onClick"])]),_:2},1024)]),_:1})]),_:1},8,["data"])),[[we,D.value]])]),_:1}),t(ke,{modelValue:C.value,"onUpdate:modelValue":e[8]||(e[8]=s=>C.value=s),title:"添加监控商品",width:"600px",onClose:de,"destroy-on-close":""},{footer:a(()=>[t(k,{onClick:e[7]||(e[7]=s=>C.value=!1)},{default:a(()=>[...e[23]||(e[23]=[d("取消",-1)])]),_:1}),t(k,{type:"primary",onClick:te,loading:B.value,disabled:!Q.value},{default:a(()=>[...e[24]||(e[24]=[d(" 开始监控 ",-1)])]),_:1},8,["loading","disabled"])]),default:a(()=>[t(be,{modelValue:N.value,"onUpdate:modelValue":e[3]||(e[3]=s=>N.value=s),class:"add-tabs"},{default:a(()=>[t(R,{label:"智能解析",name:"smart"},{default:a(()=>{var s;return[n("div",ft,[t($,{modelValue:r.value.input,"onUpdate:modelValue":e[0]||(e[0]=i=>r.value.input=i),placeholder:"粘贴商品链接或输入 Key (例如: beta-lt-jacket)","prefix-icon":f(Ae),onInput:Z,clearable:""},null,8,["modelValue","prefix-icon"]),e[21]||(e[21]=n("div",{class:"tip-text"},"支持 Arc'teryx 和 Scheels 链接/Key",-1)),p.value.success?(u(),y("div",mt,[n("div",gt,[t(_,null,{default:a(()=>[t(f(Me))]),_:1}),e[17]||(e[17]=d(" 识别成功 ",-1))]),n("div",yt,[n("div",bt,[e[18]||(e[18]=n("span",{class:"label"},"站点:",-1)),d(" "+c(p.value.site_name),1)]),n("div",ht,[e[19]||(e[19]=n("span",{class:"label"},"Key:",-1)),d(" "+c(p.value.key),1)]),(s=p.value.categories)!=null&&s.length?(u(),y("div",kt,[e[20]||(e[20]=n("span",{class:"label"},"分类:",-1)),t(ge,{modelValue:r.value.category,"onUpdate:modelValue":e[1]||(e[1]=i=>r.value.category=i),size:"small",onChange:ee},{default:a(()=>[(u(!0),y(T,null,P(p.value.categories,i=>(u(),w(me,{key:i.value,value:i.value},{default:a(()=>[d(c(i.label),1)]),_:2},1032,["value"]))),128))]),_:1},8,["modelValue"])])):U("",!0)]),n("div",wt,[t(ye,{href:A.value,target:"_blank",type:"primary"},{default:a(()=>[d(c(A.value),1)]),_:1},8,["href"])])])):p.value.error?(u(),y("div",Vt,c(p.value.error),1)):U("",!0)])]}),_:1}),t(R,{label:"手动填写",name:"manual"},{default:a(()=>[t(j,{"label-position":"top"},{default:a(()=>[t(I,{label:"商品链接 (URL)"},{default:a(()=>[t($,{modelValue:r.value.input,"onUpdate:modelValue":e[2]||(e[2]=s=>r.value.input=s),placeholder:"https://..."},null,8,["modelValue"])]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"]),t(he,{"content-position":"center"},{default:a(()=>[...e[22]||(e[22]=[d("监控选项",-1)])]),_:1}),t(j,{"label-width":"80px"},{default:a(()=>[t(I,{label:"商品名称"},{default:a(()=>[t($,{modelValue:r.value.name,"onUpdate:modelValue":e[4]||(e[4]=s=>r.value.name=s),placeholder:"可选，默认自动获取"},null,8,["modelValue"])]),_:1}),t(I,{label:"目标尺码"},{default:a(()=>[t(H,{modelValue:r.value.target_sizes,"onUpdate:modelValue":e[5]||(e[5]=s=>r.value.target_sizes=s),multiple:"",placeholder:"所有尺码",style:{width:"100%"}},{default:a(()=>[(u(),y(T,null,P(["XS","S","M","L","XL","2XL","XXL"],s=>t(W,{key:s,label:s,value:s},null,8,["label","value"])),64))]),_:1},8,["modelValue"])]),_:1}),t(I,{label:"目标颜色"},{default:a(()=>[t(H,{modelValue:r.value.target_colors,"onUpdate:modelValue":e[6]||(e[6]=s=>r.value.target_colors=s),multiple:"",filterable:"","allow-create":"","default-first-option":"",loading:S.value,placeholder:"所有颜色 (支持手动输入)",style:{width:"100%"}},{default:a(()=>[(u(!0),y(T,null,P(V.value,s=>(u(),w(W,{key:s.value,label:s.label,value:s.label},null,8,["label","value"]))),128))]),_:1},8,["modelValue","loading"]),p.value.success&&!S.value&&V.value.length===0?(u(),y("div",Ct," 未获取到可选颜色，可手动输入 ")):U("",!0)]),_:1})]),_:1})]),_:1},8,["modelValue"])])}}},Ut=Je(zt,[["__scopeId","data-v-28d6fb47"]]);export{Ut as default};
