import{r as C,o as ee,x as te,a as b,b as u,d as e,j as n,w as a,e as r,l as g,p as X,m as d,y as i,z as ae,A as se,B as le,t as _,k as ne,C as P,D as $,G as U,H as oe,I as re,F as D,q as E,J as ie,K as ue,L as de,M as ce,N as _e,E as m,O as fe,P as ve,Q as me,R as pe,S as ge}from"./index-DIgo_7TP.js";import{_ as ye}from"./_plugin-vue_export-helper-DlAUqK2U.js";const ke={class:"inventory-container"},he={class:"stat-item"},be={class:"stat-content"},we={class:"stat-value"},ze={class:"stat-item"},Ve={class:"stat-content"},Ce={class:"stat-value"},Le={class:"stat-item"},Se={class:"stat-content"},xe={class:"stat-value"},Ie={class:"stat-item control-buttons"},Xe={class:"products-section"},Ue={class:"section-header"},Te={class:"product-header"},Be={class:"product-info"},Me={class:"product-name"},Ne={class:"product-meta"},Pe={key:0,class:"target-sizes"},$e={key:0,class:"coming-soon-notice"},De={class:"product-footer"},Ee={key:0,class:"check-time"},Re={__name:"Inventory",setup(Ae){const c=C({is_running:!1,last_check_time:null,monitored_products:0,products:[]}),L=C(!1),S=C(!1),w=C(!1),f=C({url:"",name:"",target_sizes:[]});let x=null;const k=async()=>{try{const s=await se();c.value=s.data}catch(s){console.error("获取库存监控状态失败:",s)}},R=async()=>{var s,t;L.value=!0;try{const o=await _e();m.success(`检查完成: ${o.data.products_checked} 个商品, ${o.data.changes_detected} 个变化`),await k()}catch(o){m.error(((t=(s=o.response)==null?void 0:s.data)==null?void 0:t.detail)||"检查失败")}finally{L.value=!1}},A=async()=>{var s,t;try{c.value.is_running?(await fe(),m.success("库存监控已停止")):(await ve(),m.success("库存监控已启动")),await k()}catch(o){m.error(((t=(s=o.response)==null?void 0:s.data)==null?void 0:t.detail)||"操作失败")}},q=async()=>{var s,t;if(!f.value.url){m.warning("请输入商品URL");return}S.value=!0;try{await ge(f.value),m.success("商品添加成功"),w.value=!1,f.value={url:"",name:"",target_sizes:[]},await k()}catch(o){m.error(((t=(s=o.response)==null?void 0:s.data)==null?void 0:t.detail)||"添加失败")}finally{S.value=!1}},F=async s=>{var t,o;try{await me.confirm("确定要移除该商品的监控吗？","确认",{type:"warning"}),await pe(s),m.success("商品已移除"),await k()}catch(p){p!=="cancel"&&m.error(((o=(t=p.response)==null?void 0:t.data)==null?void 0:o.detail)||"移除失败")}},T=s=>s?new Date(s).toLocaleString("zh-CN"):"从未",j=s=>s.includes("scheels.com")?"Scheels":s.includes("arcteryx.com")?"Arc'teryx官网":"其他",G=(s,t)=>!t||t.length===0?!1:t.includes(s),H=s=>{switch(s){case"available":return"success";case"coming_soon":return"warning";case"unavailable":return"danger";default:return"info"}},J=s=>{switch(s){case"available":return"已上架";case"coming_soon":return"即将上架";case"unavailable":return"已下架";default:return"未知"}};return ee(()=>{k(),x=setInterval(k,3e4)}),te(()=>{x&&clearInterval(x)}),(s,t)=>{const o=r("el-icon"),p=r("el-card"),z=r("el-col"),h=r("el-button"),B=r("el-row"),V=r("el-tag"),M=r("el-table-column"),K=r("el-table"),O=r("el-link"),Q=r("el-empty"),N=r("el-input"),I=r("el-form-item"),y=r("el-option"),W=r("el-select"),Y=r("el-form"),Z=r("el-dialog");return u(),b("div",ke,[e(B,{gutter:20,class:"status-row"},{default:a(()=>[e(z,{span:6},{default:a(()=>[e(p,{class:"status-card",shadow:"hover"},{default:a(()=>[n("div",he,[e(o,{class:"stat-icon",style:{background:"linear-gradient(135deg, #667eea 0%, #764ba2 100%)"}},{default:a(()=>[e(i(le))]),_:1}),n("div",be,[n("div",we,_(c.value.monitored_products),1),t[6]||(t[6]=n("div",{class:"stat-label"},"监控商品数",-1))])])]),_:1})]),_:1}),e(z,{span:6},{default:a(()=>[e(p,{class:"status-card",shadow:"hover"},{default:a(()=>[n("div",ze,[e(o,{class:"stat-icon",style:ne({background:c.value.is_running?"linear-gradient(135deg, #11998e 0%, #38ef7d 100%)":"linear-gradient(135deg, #e74c3c 0%, #c0392b 100%)"})},{default:a(()=>[c.value.is_running?(u(),g(i(P),{key:0})):(u(),g(i($),{key:1}))]),_:1},8,["style"]),n("div",Ve,[n("div",Ce,_(c.value.is_running?"运行中":"已停止"),1),t[7]||(t[7]=n("div",{class:"stat-label"},"监控状态",-1))])])]),_:1})]),_:1}),e(z,{span:6},{default:a(()=>[e(p,{class:"status-card",shadow:"hover"},{default:a(()=>[n("div",Le,[e(o,{class:"stat-icon",style:{background:"linear-gradient(135deg, #f093fb 0%, #f5576c 100%)"}},{default:a(()=>[e(i(U))]),_:1}),n("div",Se,[n("div",xe,_(T(c.value.last_check_time)),1),t[8]||(t[8]=n("div",{class:"stat-label"},"上次检查",-1))])])]),_:1})]),_:1}),e(z,{span:6},{default:a(()=>[e(p,{class:"status-card",shadow:"hover"},{default:a(()=>[n("div",Ie,[e(h,{type:"primary",loading:L.value,onClick:R,icon:i(oe)},{default:a(()=>[...t[9]||(t[9]=[d(" 立即检查 ",-1)])]),_:1},8,["loading","icon"]),e(h,{type:c.value.is_running?"danger":"success",onClick:A,icon:c.value.is_running?i($):i(P)},{default:a(()=>[d(_(c.value.is_running?"停止监控":"启动监控"),1)]),_:1},8,["type","icon"])])]),_:1})]),_:1})]),_:1}),n("div",Xe,[n("div",Ue,[n("h3",null,[e(o,null,{default:a(()=>[e(i(re))]),_:1}),t[10]||(t[10]=d(" 商品库存监控",-1))]),e(h,{type:"primary",size:"small",icon:i(ae),onClick:t[0]||(t[0]=l=>w.value=!0)},{default:a(()=>[...t[11]||(t[11]=[d(" 添加商品 ",-1)])]),_:1},8,["icon"])]),e(B,{gutter:20},{default:a(()=>[(u(!0),b(D,null,E(c.value.products,l=>(u(),g(z,{span:12,key:l.url},{default:a(()=>[e(p,{class:"product-card",shadow:"hover"},{header:a(()=>[n("div",Te,[n("div",Be,[n("h4",Me,_(l.name||"未知商品"),1),n("div",Ne,[e(V,{size:"small",type:"info"},{default:a(()=>[d(_(j(l.url)),1)]),_:2},1024),e(V,{size:"small",type:H(l.status),effect:"dark"},{default:a(()=>[d(_(J(l.status)),1)]),_:2},1032,["type"]),l.target_sizes.length>0?(u(),b("span",Pe,[t[12]||(t[12]=d(" 目标尺码: ",-1)),(u(!0),b(D,null,E(l.target_sizes,v=>(u(),g(V,{size:"small",key:v,type:"warning"},{default:a(()=>[d(_(v),1)]),_:2},1024))),128))])):X("",!0)])]),e(h,{type:"danger",size:"small",icon:i(ce),circle:"",onClick:v=>F(l.url)},null,8,["icon","onClick"])])]),default:a(()=>[l.status==="coming_soon"?(u(),b("div",$e,[e(o,null,{default:a(()=>[e(i(U))]),_:1}),t[13]||(t[13]=n("span",null,"商品即将上架，正在监控中...",-1))])):(u(),g(K,{key:1,data:l.variants,size:"small",stripe:""},{default:a(()=>[e(M,{prop:"size",label:"尺码",width:"100",align:"center"},{default:a(({row:v})=>[e(V,{type:G(v.size,l.target_sizes)?"warning":"info",size:"small"},{default:a(()=>[d(_(v.size),1)]),_:2},1032,["type"])]),_:2},1024),e(M,{prop:"stock_status",label:"库存状态",align:"center"},{default:a(({row:v})=>[e(V,{type:v.is_available?"success":"danger",effect:"dark"},{default:a(()=>[v.is_available?(u(),g(o,{key:0},{default:a(()=>[e(i(ie))]),_:1})):(u(),g(o,{key:1},{default:a(()=>[e(i(ue))]),_:1})),d(" "+_(v.is_available?"有货":"缺货"),1)]),_:2},1032,["type"])]),_:1})]),_:2},1032,["data"])),n("div",De,[l.last_check_time?(u(),b("div",Ee,[e(o,null,{default:a(()=>[e(i(U))]),_:1}),d(" 检查时间: "+_(T(l.last_check_time)),1)])):X("",!0),e(O,{href:l.url,target:"_blank",type:"primary"},{default:a(()=>[e(o,null,{default:a(()=>[e(i(de))]),_:1}),t[14]||(t[14]=d(" 查看商品 ",-1))]),_:1},8,["href"])])]),_:2},1024)]),_:2},1024))),128))]),_:1}),c.value.products.length===0?(u(),g(Q,{key:0,description:"暂无监控商品，请添加商品开始监控"})):X("",!0)]),e(Z,{modelValue:w.value,"onUpdate:modelValue":t[5]||(t[5]=l=>w.value=l),title:"添加监控商品",width:"500px"},{footer:a(()=>[e(h,{onClick:t[4]||(t[4]=l=>w.value=!1)},{default:a(()=>[...t[16]||(t[16]=[d("取消",-1)])]),_:1}),e(h,{type:"primary",onClick:q,loading:S.value},{default:a(()=>[...t[17]||(t[17]=[d("添加",-1)])]),_:1},8,["loading"])]),default:a(()=>[e(Y,{model:f.value,"label-width":"100px"},{default:a(()=>[e(I,{label:"商品URL",required:""},{default:a(()=>[e(N,{modelValue:f.value.url,"onUpdate:modelValue":t[1]||(t[1]=l=>f.value.url=l),placeholder:"请输入商品页面URL"},null,8,["modelValue"])]),_:1}),e(I,{label:"商品名称"},{default:a(()=>[e(N,{modelValue:f.value.name,"onUpdate:modelValue":t[2]||(t[2]=l=>f.value.name=l),placeholder:"可选，留空则自动获取"},null,8,["modelValue"])]),_:1}),e(I,{label:"目标尺码"},{default:a(()=>[e(W,{modelValue:f.value.target_sizes,"onUpdate:modelValue":t[3]||(t[3]=l=>f.value.target_sizes=l),multiple:"",placeholder:"选择要监控的尺码",style:{width:"100%"}},{default:a(()=>[e(y,{label:"XS",value:"XS"}),e(y,{label:"S",value:"S"}),e(y,{label:"M",value:"M"}),e(y,{label:"L",value:"L"}),e(y,{label:"XL",value:"XL"}),e(y,{label:"2XL",value:"2XL"}),e(y,{label:"XXL",value:"XXL"})]),_:1},8,["modelValue"]),t[15]||(t[15]=n("div",{class:"form-tip"},"留空则监控所有尺码",-1))]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"])])}}},je=ye(Re,[["__scopeId","data-v-2010309a"]]);export{je as default};
