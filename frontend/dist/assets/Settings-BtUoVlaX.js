import{r as c,ah as J,j as X,c as Y,o as v,b as l,w as t,d as i,ai as Z,E as u,P as $,R as x,B as k,a as s,i as y,aj as ee,ak as le,al as te,am as ae,an as oe}from"./index-D7RlJP8t.js";import{_ as ne}from"./_plugin-vue_export-helper-DlAUqK2U.js";const se={class:"settings-page"},de={class:"card-header"},re={class:"card-header"},ie={class:"card-header"},ue={class:"card-header"},me={class:"card-header"},pe={class:"card-header"},fe={class:"action-section"},_e={__name:"Settings",setup(ye){const f=c(!1),U=c(!1),C=c(!1),S=c(!1),h=c(!1),T=c(!1),a=J({monitor:{url:"",interval_minutes:10,timeout_seconds:60,retry_times:3,headless:!0},email:{enabled:!0,smtp_server:"smtp.qq.com",smtp_port:465,sender:"",password:"",receiver:""},wechat:{enabled:!1,sendkey:""},qq:{enabled:!1,key:"",qq:""},notification:{notify_on_added:!0,notify_on_removed:!0,notify_on_error:!0}}),j=async()=>{f.value=!0;try{const d=await Z();Object.assign(a.monitor,d.data.monitor),Object.assign(a.email,d.data.email),Object.assign(a.notification,d.data.notification),d.data.wechat&&Object.assign(a.wechat,d.data.wechat),d.data.qq&&Object.assign(a.qq,d.data.qq)}catch(d){console.error("获取设置失败:",d),u.error("获取设置失败")}finally{f.value=!1}},O=async()=>{var d,e;U.value=!0;try{await ae({monitor:a.monitor,email:a.email,wechat:a.wechat,qq:a.qq,notification:a.notification}),u.success("配置已保存")}catch(n){console.error("保存失败:",n),u.error("保存失败: "+(((e=(d=n.response)==null?void 0:d.data)==null?void 0:e.detail)||n.message))}finally{U.value=!1}},E=async()=>{C.value=!0;try{await oe(),await j(),u.success("配置已重新加载")}catch(d){console.error("重新加载失败:",d),u.error("重新加载失败")}finally{C.value=!1}},K=async()=>{var d,e;S.value=!0;try{const n=await ee();n.data.success?u.success("测试邮件发送成功，请检查收件箱"):u.warning(n.data.message||"发送失败")}catch(n){console.error("发送测试邮件失败:",n),u.error("发送失败: "+(((e=(d=n.response)==null?void 0:d.data)==null?void 0:e.detail)||n.message))}finally{S.value=!1}},P=async()=>{var d,e;h.value=!0;try{const n=await le();n.data.success?u.success("微信测试消息发送成功"):u.warning(n.data.message||"发送失败")}catch(n){console.error("发送微信测试消息失败:",n),u.error("发送失败: "+(((e=(d=n.response)==null?void 0:d.data)==null?void 0:e.detail)||n.message))}finally{h.value=!1}},D=async()=>{var d,e;T.value=!0;try{const n=await te();n.data.success?u.success("QQ测试消息发送成功"):u.warning(n.data.message||"发送失败")}catch(n){console.error("发送QQ测试消息失败:",n),u.error("发送失败: "+(((e=(d=n.response)==null?void 0:d.data)==null?void 0:e.detail)||n.message))}finally{T.value=!1}};return X(()=>{j()}),(d,e)=>{const n=i("Monitor"),m=i("el-icon"),p=i("el-input"),r=i("el-form-item"),Q=i("el-input-number"),_=i("el-switch"),w=i("el-form"),g=i("el-card"),V=i("el-col"),z=i("Message"),M=i("Promotion"),b=i("el-button"),R=i("el-row"),L=i("ChatDotRound"),B=i("el-link"),N=i("ChatLineSquare"),W=i("Bell"),I=i("Operation"),A=i("Check"),F=i("RefreshRight"),G=i("el-divider"),H=i("el-alert"),q=$("loading");return v(),Y("div",se,[l(R,{gutter:20},{default:t(()=>[l(V,{span:12},{default:t(()=>[l(g,null,{header:t(()=>[s("div",de,[l(m,null,{default:t(()=>[l(n)]),_:1}),e[19]||(e[19]=s("span",null,"监控配置",-1))])]),default:t(()=>[x((v(),k(w,{model:a.monitor,"label-width":"100px"},{default:t(()=>[l(r,{label:"监控URL"},{default:t(()=>[l(p,{modelValue:a.monitor.url,"onUpdate:modelValue":e[0]||(e[0]=o=>a.monitor.url=o),disabled:""},null,8,["modelValue"])]),_:1}),l(r,{label:"检测间隔"},{default:t(()=>[l(Q,{modelValue:a.monitor.interval_minutes,"onUpdate:modelValue":e[1]||(e[1]=o=>a.monitor.interval_minutes=o),min:1,max:1440,style:{width:"150px"}},null,8,["modelValue"]),e[20]||(e[20]=s("span",{style:{"margin-left":"10px"}},"分钟",-1))]),_:1}),l(r,{label:"超时时间"},{default:t(()=>[l(Q,{modelValue:a.monitor.timeout_seconds,"onUpdate:modelValue":e[2]||(e[2]=o=>a.monitor.timeout_seconds=o),min:10,max:300,style:{width:"150px"}},null,8,["modelValue"]),e[21]||(e[21]=s("span",{style:{"margin-left":"10px"}},"秒",-1))]),_:1}),l(r,{label:"重试次数"},{default:t(()=>[l(Q,{modelValue:a.monitor.retry_times,"onUpdate:modelValue":e[3]||(e[3]=o=>a.monitor.retry_times=o),min:0,max:10,style:{width:"150px"}},null,8,["modelValue"])]),_:1}),l(r,{label:"无头模式"},{default:t(()=>[l(_,{modelValue:a.monitor.headless,"onUpdate:modelValue":e[4]||(e[4]=o=>a.monitor.headless=o)},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])),[[q,f.value]])]),_:1})]),_:1}),l(V,{span:12},{default:t(()=>[l(g,null,{header:t(()=>[s("div",re,[l(m,null,{default:t(()=>[l(z)]),_:1}),e[22]||(e[22]=s("span",null,"邮件通知",-1))])]),default:t(()=>[x((v(),k(w,{model:a.email,"label-width":"100px"},{default:t(()=>[l(r,{label:"启用通知"},{default:t(()=>[l(_,{modelValue:a.email.enabled,"onUpdate:modelValue":e[5]||(e[5]=o=>a.email.enabled=o)},null,8,["modelValue"])]),_:1}),l(r,{label:"SMTP服务器"},{default:t(()=>[l(p,{modelValue:a.email.smtp_server,"onUpdate:modelValue":e[6]||(e[6]=o=>a.email.smtp_server=o)},null,8,["modelValue"])]),_:1}),l(r,{label:"SMTP端口"},{default:t(()=>[l(Q,{modelValue:a.email.smtp_port,"onUpdate:modelValue":e[7]||(e[7]=o=>a.email.smtp_port=o),min:1,max:65535,style:{width:"150px"}},null,8,["modelValue"])]),_:1}),l(r,{label:"发件人"},{default:t(()=>[l(p,{modelValue:a.email.sender,"onUpdate:modelValue":e[8]||(e[8]=o=>a.email.sender=o),placeholder:"your_qq@qq.com"},null,8,["modelValue"])]),_:1}),l(r,{label:"授权码"},{default:t(()=>[l(p,{modelValue:a.email.password,"onUpdate:modelValue":e[9]||(e[9]=o=>a.email.password=o),type:"password",placeholder:"QQ邮箱授权码","show-password":""},null,8,["modelValue"])]),_:1}),l(r,{label:"收件人"},{default:t(()=>[l(p,{modelValue:a.email.receiver,"onUpdate:modelValue":e[10]||(e[10]=o=>a.email.receiver=o),placeholder:"接收通知的邮箱"},null,8,["modelValue"])]),_:1}),l(r,null,{default:t(()=>[l(b,{type:"info",onClick:K,loading:S.value},{default:t(()=>[l(m,null,{default:t(()=>[l(M)]),_:1}),e[23]||(e[23]=y(" 发送测试邮件 ",-1))]),_:1},8,["loading"])]),_:1})]),_:1},8,["model"])),[[q,f.value]])]),_:1})]),_:1})]),_:1}),l(R,{gutter:20,style:{"margin-top":"20px"}},{default:t(()=>[l(V,{span:12},{default:t(()=>[l(g,null,{header:t(()=>[s("div",ie,[l(m,null,{default:t(()=>[l(L)]),_:1}),e[24]||(e[24]=s("span",null,"微信通知 (ServerChan)",-1))])]),default:t(()=>[x((v(),k(w,{model:a.wechat,"label-width":"100px"},{default:t(()=>[l(r,{label:"启用通知"},{default:t(()=>[l(_,{modelValue:a.wechat.enabled,"onUpdate:modelValue":e[11]||(e[11]=o=>a.wechat.enabled=o)},null,8,["modelValue"])]),_:1}),l(r,{label:"SendKey"},{default:t(()=>[l(p,{modelValue:a.wechat.sendkey,"onUpdate:modelValue":e[12]||(e[12]=o=>a.wechat.sendkey=o),type:"password",placeholder:"ServerChan SendKey","show-password":""},null,8,["modelValue"])]),_:1}),l(r,null,{default:t(()=>[l(B,{type:"primary",href:"https://sct.ftqq.com",target:"_blank",rel:"noopener noreferrer"},{default:t(()=>[...e[25]||(e[25]=[y(" 获取 SendKey ",-1)])]),_:1}),e[26]||(e[26]=s("span",{class:"form-tip"},"微信扫码登录后获取",-1))]),_:1}),l(r,null,{default:t(()=>[l(b,{type:"info",onClick:P,loading:h.value,disabled:!a.wechat.sendkey||a.wechat.sendkey==="******"},{default:t(()=>[l(m,null,{default:t(()=>[l(M)]),_:1}),e[27]||(e[27]=y(" 发送测试消息 ",-1))]),_:1},8,["loading","disabled"])]),_:1})]),_:1},8,["model"])),[[q,f.value]])]),_:1})]),_:1}),l(V,{span:12},{default:t(()=>[l(g,null,{header:t(()=>[s("div",ue,[l(m,null,{default:t(()=>[l(N)]),_:1}),e[28]||(e[28]=s("span",null,"QQ通知 (Qmsg酱)",-1))])]),default:t(()=>[x((v(),k(w,{model:a.qq,"label-width":"100px"},{default:t(()=>[l(r,{label:"启用通知"},{default:t(()=>[l(_,{modelValue:a.qq.enabled,"onUpdate:modelValue":e[13]||(e[13]=o=>a.qq.enabled=o)},null,8,["modelValue"])]),_:1}),l(r,{label:"Key"},{default:t(()=>[l(p,{modelValue:a.qq.key,"onUpdate:modelValue":e[14]||(e[14]=o=>a.qq.key=o),type:"password",placeholder:"Qmsg酱 Key","show-password":""},null,8,["modelValue"])]),_:1}),l(r,{label:"QQ号"},{default:t(()=>[l(p,{modelValue:a.qq.qq,"onUpdate:modelValue":e[15]||(e[15]=o=>a.qq.qq=o),placeholder:"接收通知的QQ号"},null,8,["modelValue"])]),_:1}),l(r,null,{default:t(()=>[l(B,{type:"primary",href:"https://qmsg.zendee.cn",target:"_blank",rel:"noopener noreferrer"},{default:t(()=>[...e[29]||(e[29]=[y(" 获取 Key ",-1)])]),_:1}),e[30]||(e[30]=s("span",{class:"form-tip"},"注册后添加机器人为好友",-1))]),_:1}),l(r,null,{default:t(()=>[l(b,{type:"info",onClick:D,loading:T.value,disabled:!a.qq.key||a.qq.key==="******"||!a.qq.qq},{default:t(()=>[l(m,null,{default:t(()=>[l(M)]),_:1}),e[31]||(e[31]=y(" 发送测试消息 ",-1))]),_:1},8,["loading","disabled"])]),_:1})]),_:1},8,["model"])),[[q,f.value]])]),_:1})]),_:1})]),_:1}),l(R,{gutter:20,style:{"margin-top":"20px"}},{default:t(()=>[l(V,{span:12},{default:t(()=>[l(g,null,{header:t(()=>[s("div",me,[l(m,null,{default:t(()=>[l(W)]),_:1}),e[32]||(e[32]=s("span",null,"通知设置",-1))])]),default:t(()=>[x((v(),k(w,{model:a.notification,"label-width":"120px"},{default:t(()=>[l(r,{label:"新增商品通知"},{default:t(()=>[l(_,{modelValue:a.notification.notify_on_added,"onUpdate:modelValue":e[16]||(e[16]=o=>a.notification.notify_on_added=o)},null,8,["modelValue"]),e[33]||(e[33]=s("span",{class:"form-tip"},"商品数量增加时发送通知",-1))]),_:1}),l(r,{label:"下架商品通知"},{default:t(()=>[l(_,{modelValue:a.notification.notify_on_removed,"onUpdate:modelValue":e[17]||(e[17]=o=>a.notification.notify_on_removed=o)},null,8,["modelValue"]),e[34]||(e[34]=s("span",{class:"form-tip"},"商品下架时发送通知",-1))]),_:1}),l(r,{label:"异常告警通知"},{default:t(()=>[l(_,{modelValue:a.notification.notify_on_error,"onUpdate:modelValue":e[18]||(e[18]=o=>a.notification.notify_on_error=o)},null,8,["modelValue"]),e[35]||(e[35]=s("span",{class:"form-tip"},"监控程序出错时发送通知",-1))]),_:1})]),_:1},8,["model"])),[[q,f.value]])]),_:1})]),_:1}),l(V,{span:12},{default:t(()=>[l(g,null,{header:t(()=>[s("div",pe,[l(m,null,{default:t(()=>[l(I)]),_:1}),e[36]||(e[36]=s("span",null,"操作",-1))])]),default:t(()=>[s("div",fe,[l(b,{type:"primary",size:"large",onClick:O,loading:U.value,style:{width:"200px"}},{default:t(()=>[l(m,null,{default:t(()=>[l(A)]),_:1}),e[37]||(e[37]=y(" 保存配置 ",-1))]),_:1},8,["loading"]),l(b,{size:"large",onClick:E,loading:C.value,style:{width:"200px","margin-left":"20px"}},{default:t(()=>[l(m,null,{default:t(()=>[l(F)]),_:1}),e[38]||(e[38]=y(" 重新加载 ",-1))]),_:1},8,["loading"])]),l(G),l(H,{title:"配置说明",type:"info",closable:!1},{default:t(()=>[...e[39]||(e[39]=[s("ul",{style:{margin:"10px 0","padding-left":"20px","line-height":"1.8"}},[s("li",null,'修改配置后需要点击"保存配置"按钮'),s("li",null,"可同时启用多个通知渠道"),s("li",null,"建议先发送测试消息验证配置是否正确"),s("li",null,"QQ邮箱授权码需要在QQ邮箱设置中开启SMTP服务后获取")],-1)])]),_:1})]),_:1})]),_:1})]),_:1})])}}},ce=ne(_e,[["__scopeId","data-v-587a011d"]]);export{ce as default};
