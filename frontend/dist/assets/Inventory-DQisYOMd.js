import{r as y,H as be,o as we,I as ke,c as b,a as _,b as t,w as l,d as o,e as he,J as Ve,j as s,u as v,K as xe,t as d,p as ze,q as h,v as W,x as q,n as Ce,y as Se,l as u,L as Ie,A as N,F as X,B as A,M as Ue,N as Te,O as Le,P as Pe,Q as Be,R as De,S as Me,E as w,T as Ne,U as Xe,V as Ae,W as Ee,X as Ke,Y as $e}from"./index-Bn3zVtQM.js";import{_ as Re}from"./_plugin-vue_export-helper-DlAUqK2U.js";const je={class:"inventory-view"},Fe={class:"stat-card"},We={class:"icon-wrapper bg-blue"},qe={class:"content"},He={class:"value"},Je={class:"stat-card"},Oe={class:"content"},Qe={class:"value"},Ye={class:"stat-card"},Ge={class:"icon-wrapper bg-purple"},Ze={class:"content"},et={class:"value"},tt={class:"card-header"},lt={class:"header-title"},at={class:"variants-container"},st={key:0,class:"coming-soon-alert"},nt={class:"product-name-cell"},ot={class:"name-text"},it={class:"tags-wrapper"},rt={key:0,class:"text-gray"},ut={class:"text-gray"},dt={class:"tab-content"},ct={key:0,class:"parse-success-card"},_t={class:"header"},pt={class:"info-grid"},vt={class:"item"},mt={class:"item"},ft={key:0,class:"item full"},gt={class:"preview-link"},yt={key:1,class:"parse-error-msg"},bt={__name:"Inventory",setup(wt){const f=y({is_running:!1,last_check_time:null,monitored_products:0,products:[]}),S=y(!1),I=y(!1),U=y(!1),V=y(!1),T=y("smart");let L=null;const i=y({input:"",name:"",category:"",target_sizes:[],target_colors:[]}),p=y({success:!1,error:null}),P=y("");let B=null;const H=be(()=>T.value==="manual"?!!i.value.input:p.value.success||i.value.input&&!p.value.error),x=async()=>{try{const n=await he();f.value=n.data}catch(n){console.error(n)}},E=async()=>{var n,e;I.value=!0;try{const c=await Me();w.success(`检查完成: 变动 ${c.data.changes_detected}`),await x()}catch(c){w.error(((e=(n=c.response)==null?void 0:n.data)==null?void 0:e.detail)||"检查失败")}finally{I.value=!1}},J=async()=>{try{f.value.is_running?(await Ne(),w.success("监控已停止")):(await Xe(),w.success("监控已启动")),await x()}catch{w.error("操作失败")}},O=()=>{B&&clearTimeout(B),B=setTimeout(Q,500)},Q=async()=>{var e,c;const n=i.value.input.trim();if(!n){p.value={success:!1,error:null};return}try{const m=await $e(n);p.value=m.data,m.data.success&&(P.value=m.data.url,m.data.category&&(i.value.category=m.data.category))}catch(m){p.value={success:!1,error:((c=(e=m.response)==null?void 0:e.data)==null?void 0:c.detail)||"无法解析"}}},Y=()=>{},G=async()=>{var n,e;U.value=!0;try{await Ke({input:i.value.input,name:i.value.name,category:i.value.category,target_sizes:i.value.target_sizes,target_colors:i.value.target_colors}),w.success("添加成功"),V.value=!1,E()}catch(c){w.error(((e=(n=c.response)==null?void 0:n.data)==null?void 0:e.detail)||"添加失败")}finally{U.value=!1}},Z=async n=>{try{await Ae.confirm("确定移除该商品吗?","警告",{type:"warning"}),await Ee(n),w.success("已移除"),x()}catch{}},ee=n=>window.open(n,"_blank"),K=n=>n?new Date(n).toLocaleString("zh-CN",{month:"numeric",day:"numeric",hour:"2-digit",minute:"2-digit"}):"从未",te=n=>n.includes("scheels")?"Scheels":n.includes("arcteryx")?"Arc'teryx":"Site",le=(n,e)=>!e||!e.length?!0:e.includes(n),ae=n=>({available:"success",coming_soon:"warning",unavailable:"danger"})[n]||"info",se=n=>({available:"现货",coming_soon:"即将上架",unavailable:"缺货"})[n]||n,ne=()=>{i.value={input:"",name:"",category:"",target_sizes:[],target_colors:[]},p.value={success:!1},V.value=!0},oe=()=>{};return we(()=>{S.value=!0,x().finally(()=>S.value=!1),L=setInterval(x,3e4)}),ke(()=>{L&&clearInterval(L)}),(n,e)=>{const c=o("el-icon"),m=o("el-col"),k=o("el-button"),ie=o("el-row"),re=o("el-alert"),z=o("el-tag"),g=o("el-table-column"),$=o("el-table"),ue=o("el-button-group"),de=o("el-empty"),ce=o("el-card"),D=o("el-input"),_e=o("el-radio-button"),pe=o("el-radio-group"),ve=o("el-link"),R=o("el-tab-pane"),C=o("el-form-item"),j=o("el-form"),me=o("el-tabs"),fe=o("el-divider"),M=o("el-option"),F=o("el-select"),ge=o("el-dialog"),ye=Ve("loading");return _(),b("div",je,[t(ie,{gutter:20,class:"overview-row"},{default:l(()=>[t(m,{span:6},{default:l(()=>[s("div",Fe,[s("div",We,[t(c,null,{default:l(()=>[t(v(xe))]),_:1})]),s("div",qe,[s("div",He,d(f.value.monitored_products),1),e[9]||(e[9]=s("div",{class:"label"},"监控商品",-1))])])]),_:1}),t(m,{span:6},{default:l(()=>[s("div",Je,[s("div",{class:ze(["icon-wrapper",f.value.is_running?"bg-green":"bg-red"])},[f.value.is_running?(_(),h(c,{key:0},{default:l(()=>[t(v(W))]),_:1})):(_(),h(c,{key:1},{default:l(()=>[t(v(q))]),_:1}))],2),s("div",Oe,[s("div",Qe,d(f.value.is_running?"运行中":"已停止"),1),e[10]||(e[10]=s("div",{class:"label"},"监控状态",-1))])])]),_:1}),t(m,{span:6},{default:l(()=>[s("div",Ye,[s("div",Ge,[t(c,null,{default:l(()=>[t(v(Ce))]),_:1})]),s("div",Ze,[s("div",et,d(K(f.value.last_check_time)),1),e[11]||(e[11]=s("div",{class:"label"},"上次检查",-1))])])]),_:1}),t(m,{span:6,class:"actions-col"},{default:l(()=>[t(k,{type:"primary",loading:I.value,onClick:E,icon:v(Se),class:"action-btn"},{default:l(()=>[...e[12]||(e[12]=[u(" 立即检查 ",-1)])]),_:1},8,["loading","icon"]),t(k,{type:f.value.is_running?"danger":"success",onClick:J,icon:f.value.is_running?v(q):v(W),class:"action-btn",plain:""},{default:l(()=>[u(d(f.value.is_running?"停止":"启动"),1)]),_:1},8,["type","icon"])]),_:1})]),_:1}),t(ce,{class:"table-card",shadow:"never"},{header:l(()=>[s("div",tt,[s("div",lt,[t(c,null,{default:l(()=>[t(v(Le))]),_:1}),e[13]||(e[13]=s("span",null,"监控列表",-1))]),t(k,{type:"primary",icon:v(Pe),onClick:ne},{default:l(()=>[...e[14]||(e[14]=[u(" 添加商品 ",-1)])]),_:1},8,["icon"])])]),default:l(()=>[Ie((_(),h($,{data:f.value.products,style:{width:"100%"},"row-key":"url"},{empty:l(()=>[t(de,{description:"暂无监控商品"})]),default:l(()=>[t(g,{type:"expand"},{default:l(a=>[s("div",at,[a.row.status==="coming_soon"?(_(),b("div",st,[t(re,{title:"商品即将上架",type:"warning",description:"该商品目前标记为即将上架，正在持续监控中。","show-icon":"",closable:!1})])):(_(),h($,{key:1,data:a.row.variants,size:"small",border:""},{default:l(()=>[t(g,{prop:"size",label:"尺码",width:"120",align:"center"},{default:l(({row:r})=>[t(z,{type:le(r.size,a.row.target_sizes)?"warning":"info",size:"small"},{default:l(()=>[u(d(r.size),1)]),_:2},1032,["type"])]),_:2},1024),t(g,{prop:"color_name",label:"颜色",width:"180","show-overflow-tooltip":""}),t(g,{prop:"stock_status",label:"库存状态",align:"center"},{default:l(({row:r})=>[t(z,{type:r.is_available?"success":"danger",effect:"dark",size:"small"},{default:l(()=>[u(d(r.is_available?"有货":"缺货"),1)]),_:2},1032,["type"])]),_:1})]),_:2},1032,["data"]))])]),_:1}),t(g,{prop:"name",label:"商品名称","min-width":"200"},{default:l(({row:a})=>[s("div",nt,[s("span",ot,d(a.name||"正在获取..."),1),t(z,{size:"small",effect:"plain",type:"info"},{default:l(()=>[u(d(te(a.url)),1)]),_:2},1024)])]),_:1}),t(g,{label:"目标",width:"200"},{default:l(({row:a})=>[s("div",it,[(_(!0),b(X,null,A(a.target_sizes,r=>(_(),h(z,{key:r,size:"small",type:"warning",effect:"plain"},{default:l(()=>[u(d(r),1)]),_:2},1024))),128)),a.target_sizes.length?N("",!0):(_(),b("span",rt,"全尺码"))])]),_:1}),t(g,{prop:"status",label:"状态",width:"120",align:"center"},{default:l(({row:a})=>[t(z,{type:ae(a.status),effect:"light"},{default:l(()=>[u(d(se(a.status)),1)]),_:2},1032,["type"])]),_:1}),t(g,{label:"最后更新",width:"180"},{default:l(({row:a})=>[s("span",ut,d(K(a.last_check_time)),1)]),_:1}),t(g,{label:"操作",width:"150",align:"right"},{default:l(({row:a})=>[t(ue,null,{default:l(()=>[t(k,{link:"",type:"primary",icon:v(Ue),onClick:r=>ee(a.url)},{default:l(()=>[...e[15]||(e[15]=[u("访问",-1)])]),_:1},8,["icon","onClick"]),t(k,{link:"",type:"danger",icon:v(Te),onClick:r=>Z(a.url)},{default:l(()=>[...e[16]||(e[16]=[u("移除",-1)])]),_:1},8,["icon","onClick"])]),_:2},1024)]),_:1})]),_:1},8,["data"])),[[ye,S.value]])]),_:1}),t(ge,{modelValue:V.value,"onUpdate:modelValue":e[8]||(e[8]=a=>V.value=a),title:"添加监控商品",width:"600px",onClose:oe,"destroy-on-close":""},{footer:l(()=>[t(k,{onClick:e[7]||(e[7]=a=>V.value=!1)},{default:l(()=>[...e[23]||(e[23]=[u("取消",-1)])]),_:1}),t(k,{type:"primary",onClick:G,loading:U.value,disabled:!H.value},{default:l(()=>[...e[24]||(e[24]=[u(" 开始监控 ",-1)])]),_:1},8,["loading","disabled"])]),default:l(()=>[t(me,{modelValue:T.value,"onUpdate:modelValue":e[3]||(e[3]=a=>T.value=a),class:"add-tabs"},{default:l(()=>[t(R,{label:"智能解析",name:"smart"},{default:l(()=>{var a;return[s("div",dt,[t(D,{modelValue:i.value.input,"onUpdate:modelValue":e[0]||(e[0]=r=>i.value.input=r),placeholder:"粘贴商品链接或输入 Key (例如: beta-lt-jacket)","prefix-icon":v(Be),onInput:O,clearable:""},null,8,["modelValue","prefix-icon"]),e[21]||(e[21]=s("div",{class:"tip-text"},"支持 Arc'teryx 和 Scheels 链接/Key",-1)),p.value.success?(_(),b("div",ct,[s("div",_t,[t(c,null,{default:l(()=>[t(v(De))]),_:1}),e[17]||(e[17]=u(" 识别成功 ",-1))]),s("div",pt,[s("div",vt,[e[18]||(e[18]=s("span",{class:"label"},"站点:",-1)),u(" "+d(p.value.site_name),1)]),s("div",mt,[e[19]||(e[19]=s("span",{class:"label"},"Key:",-1)),u(" "+d(p.value.key),1)]),(a=p.value.categories)!=null&&a.length?(_(),b("div",ft,[e[20]||(e[20]=s("span",{class:"label"},"分类:",-1)),t(pe,{modelValue:i.value.category,"onUpdate:modelValue":e[1]||(e[1]=r=>i.value.category=r),size:"small",onChange:Y},{default:l(()=>[(_(!0),b(X,null,A(p.value.categories,r=>(_(),h(_e,{key:r.value,value:r.value},{default:l(()=>[u(d(r.label),1)]),_:2},1032,["value"]))),128))]),_:1},8,["modelValue"])])):N("",!0)]),s("div",gt,[t(ve,{href:P.value,target:"_blank",type:"primary"},{default:l(()=>[u(d(P.value),1)]),_:1},8,["href"])])])):p.value.error?(_(),b("div",yt,d(p.value.error),1)):N("",!0)])]}),_:1}),t(R,{label:"手动填写",name:"manual"},{default:l(()=>[t(j,{"label-position":"top"},{default:l(()=>[t(C,{label:"商品链接 (URL)"},{default:l(()=>[t(D,{modelValue:i.value.input,"onUpdate:modelValue":e[2]||(e[2]=a=>i.value.input=a),placeholder:"https://..."},null,8,["modelValue"])]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"]),t(fe,{"content-position":"center"},{default:l(()=>[...e[22]||(e[22]=[u("监控选项",-1)])]),_:1}),t(j,{"label-width":"80px"},{default:l(()=>[t(C,{label:"商品名称"},{default:l(()=>[t(D,{modelValue:i.value.name,"onUpdate:modelValue":e[4]||(e[4]=a=>i.value.name=a),placeholder:"可选，默认自动获取"},null,8,["modelValue"])]),_:1}),t(C,{label:"目标尺码"},{default:l(()=>[t(F,{modelValue:i.value.target_sizes,"onUpdate:modelValue":e[5]||(e[5]=a=>i.value.target_sizes=a),multiple:"",placeholder:"所有尺码",style:{width:"100%"}},{default:l(()=>[(_(),b(X,null,A(["XS","S","M","L","XL","2XL","XXL"],a=>t(M,{key:a,label:a,value:a},null,8,["label","value"])),64))]),_:1},8,["modelValue"])]),_:1}),t(C,{label:"目标颜色"},{default:l(()=>[t(F,{modelValue:i.value.target_colors,"onUpdate:modelValue":e[6]||(e[6]=a=>i.value.target_colors=a),multiple:"",filterable:"","allow-create":"","default-first-option":"",placeholder:"所有颜色 (支持手动输入)",style:{width:"100%"}},{default:l(()=>[t(M,{label:"Black",value:"Black"}),t(M,{label:"Void",value:"Void"})]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1},8,["modelValue"])])}}},Vt=Re(bt,[["__scopeId","data-v-a5dcf407"]]);export{Vt as default};
