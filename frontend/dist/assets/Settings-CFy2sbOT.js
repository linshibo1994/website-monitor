import{r as v,D as G,o as H,a as J,b as y,d as l,w as o,e as a,G as L,E as u,y as F,A as k,l as C,j as s,m as q,H as K,I as W,J as X}from"./index-XZi2pCr-.js";import{_ as Y}from"./_plugin-vue_export-helper-DlAUqK2U.js";const Z={class:"settings-page"},$={class:"card-header"},h={class:"card-header"},ee={class:"card-header"},le={class:"card-header"},oe={class:"action-section"},te={__name:"Settings",setup(ne){const p=v(!1),b=v(!1),w=v(!1),x=v(!1),t=G({monitor:{url:"",interval_minutes:10,timeout_seconds:60,retry_times:3,headless:!0},email:{enabled:!0,smtp_server:"smtp.qq.com",smtp_port:465,sender:"",password:"",receiver:""},notification:{notify_on_added:!0,notify_on_removed:!0,notify_on_error:!0}}),B=async()=>{p.value=!0;try{const d=await L();Object.assign(t.monitor,d.data.monitor),Object.assign(t.email,d.data.email),Object.assign(t.notification,d.data.notification)}catch(d){console.error("获取设置失败:",d),u.error("获取设置失败")}finally{p.value=!1}},Q=async()=>{var d,e;b.value=!0;try{await W({monitor:t.monitor,email:t.email,notification:t.notification}),u.success("配置已保存")}catch(r){console.error("保存失败:",r),u.error("保存失败: "+(((e=(d=r.response)==null?void 0:d.data)==null?void 0:e.detail)||r.message))}finally{b.value=!1}},R=async()=>{w.value=!0;try{await X(),await B(),u.success("配置已重新加载")}catch(d){console.error("重新加载失败:",d),u.error("重新加载失败")}finally{w.value=!1}},T=async()=>{var d,e;x.value=!0;try{const r=await K();r.data.success?u.success("测试邮件发送成功，请检查收件箱"):u.warning(r.data.message||"发送失败")}catch(r){console.error("发送测试邮件失败:",r),u.error("发送失败: "+(((e=(d=r.response)==null?void 0:d.data)==null?void 0:e.detail)||r.message))}finally{x.value=!1}};return H(()=>{B()}),(d,e)=>{const r=a("Monitor"),m=a("el-icon"),_=a("el-input"),i=a("el-form-item"),c=a("el-input-number"),f=a("el-switch"),U=a("el-form"),g=a("el-card"),V=a("el-col"),O=a("Message"),P=a("Promotion"),M=a("el-button"),E=a("el-row"),j=a("Bell"),D=a("Operation"),N=a("Check"),z=a("RefreshRight"),I=a("el-divider"),A=a("el-alert"),S=F("loading");return y(),J("div",Z,[l(E,{gutter:20},{default:o(()=>[l(V,{span:12},{default:o(()=>[l(g,null,{header:o(()=>[s("div",$,[l(m,null,{default:o(()=>[l(r)]),_:1}),e[14]||(e[14]=s("span",null,"监控配置",-1))])]),default:o(()=>[k((y(),C(U,{model:t.monitor,"label-width":"100px"},{default:o(()=>[l(i,{label:"监控URL"},{default:o(()=>[l(_,{modelValue:t.monitor.url,"onUpdate:modelValue":e[0]||(e[0]=n=>t.monitor.url=n),disabled:""},null,8,["modelValue"])]),_:1}),l(i,{label:"检测间隔"},{default:o(()=>[l(c,{modelValue:t.monitor.interval_minutes,"onUpdate:modelValue":e[1]||(e[1]=n=>t.monitor.interval_minutes=n),min:1,max:1440,style:{width:"150px"}},null,8,["modelValue"]),e[15]||(e[15]=s("span",{style:{"margin-left":"10px"}},"分钟",-1))]),_:1}),l(i,{label:"超时时间"},{default:o(()=>[l(c,{modelValue:t.monitor.timeout_seconds,"onUpdate:modelValue":e[2]||(e[2]=n=>t.monitor.timeout_seconds=n),min:10,max:300,style:{width:"150px"}},null,8,["modelValue"]),e[16]||(e[16]=s("span",{style:{"margin-left":"10px"}},"秒",-1))]),_:1}),l(i,{label:"重试次数"},{default:o(()=>[l(c,{modelValue:t.monitor.retry_times,"onUpdate:modelValue":e[3]||(e[3]=n=>t.monitor.retry_times=n),min:0,max:10,style:{width:"150px"}},null,8,["modelValue"])]),_:1}),l(i,{label:"无头模式"},{default:o(()=>[l(f,{modelValue:t.monitor.headless,"onUpdate:modelValue":e[4]||(e[4]=n=>t.monitor.headless=n)},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])),[[S,p.value]])]),_:1})]),_:1}),l(V,{span:12},{default:o(()=>[l(g,null,{header:o(()=>[s("div",h,[l(m,null,{default:o(()=>[l(O)]),_:1}),e[17]||(e[17]=s("span",null,"邮件配置",-1))])]),default:o(()=>[k((y(),C(U,{model:t.email,"label-width":"100px"},{default:o(()=>[l(i,{label:"启用通知"},{default:o(()=>[l(f,{modelValue:t.email.enabled,"onUpdate:modelValue":e[5]||(e[5]=n=>t.email.enabled=n)},null,8,["modelValue"])]),_:1}),l(i,{label:"SMTP服务器"},{default:o(()=>[l(_,{modelValue:t.email.smtp_server,"onUpdate:modelValue":e[6]||(e[6]=n=>t.email.smtp_server=n)},null,8,["modelValue"])]),_:1}),l(i,{label:"SMTP端口"},{default:o(()=>[l(c,{modelValue:t.email.smtp_port,"onUpdate:modelValue":e[7]||(e[7]=n=>t.email.smtp_port=n),min:1,max:65535,style:{width:"150px"}},null,8,["modelValue"])]),_:1}),l(i,{label:"发件人"},{default:o(()=>[l(_,{modelValue:t.email.sender,"onUpdate:modelValue":e[8]||(e[8]=n=>t.email.sender=n),placeholder:"your_qq@qq.com"},null,8,["modelValue"])]),_:1}),l(i,{label:"授权码"},{default:o(()=>[l(_,{modelValue:t.email.password,"onUpdate:modelValue":e[9]||(e[9]=n=>t.email.password=n),type:"password",placeholder:"QQ邮箱授权码","show-password":""},null,8,["modelValue"])]),_:1}),l(i,{label:"收件人"},{default:o(()=>[l(_,{modelValue:t.email.receiver,"onUpdate:modelValue":e[10]||(e[10]=n=>t.email.receiver=n),placeholder:"接收通知的邮箱"},null,8,["modelValue"])]),_:1}),l(i,null,{default:o(()=>[l(M,{type:"info",onClick:T,loading:x.value},{default:o(()=>[l(m,null,{default:o(()=>[l(P)]),_:1}),e[18]||(e[18]=q(" 发送测试邮件 ",-1))]),_:1},8,["loading"])]),_:1})]),_:1},8,["model"])),[[S,p.value]])]),_:1})]),_:1})]),_:1}),l(E,{gutter:20,style:{"margin-top":"20px"}},{default:o(()=>[l(V,{span:12},{default:o(()=>[l(g,null,{header:o(()=>[s("div",ee,[l(m,null,{default:o(()=>[l(j)]),_:1}),e[19]||(e[19]=s("span",null,"通知设置",-1))])]),default:o(()=>[k((y(),C(U,{model:t.notification,"label-width":"120px"},{default:o(()=>[l(i,{label:"新增商品通知"},{default:o(()=>[l(f,{modelValue:t.notification.notify_on_added,"onUpdate:modelValue":e[11]||(e[11]=n=>t.notification.notify_on_added=n)},null,8,["modelValue"]),e[20]||(e[20]=s("span",{class:"form-tip"},"商品数量增加时发送邮件",-1))]),_:1}),l(i,{label:"下架商品通知"},{default:o(()=>[l(f,{modelValue:t.notification.notify_on_removed,"onUpdate:modelValue":e[12]||(e[12]=n=>t.notification.notify_on_removed=n)},null,8,["modelValue"]),e[21]||(e[21]=s("span",{class:"form-tip"},"商品下架时发送邮件",-1))]),_:1}),l(i,{label:"异常告警通知"},{default:o(()=>[l(f,{modelValue:t.notification.notify_on_error,"onUpdate:modelValue":e[13]||(e[13]=n=>t.notification.notify_on_error=n)},null,8,["modelValue"]),e[22]||(e[22]=s("span",{class:"form-tip"},"监控程序出错时发送邮件",-1))]),_:1})]),_:1},8,["model"])),[[S,p.value]])]),_:1})]),_:1}),l(V,{span:12},{default:o(()=>[l(g,null,{header:o(()=>[s("div",le,[l(m,null,{default:o(()=>[l(D)]),_:1}),e[23]||(e[23]=s("span",null,"操作",-1))])]),default:o(()=>[s("div",oe,[l(M,{type:"primary",size:"large",onClick:Q,loading:b.value,style:{width:"200px"}},{default:o(()=>[l(m,null,{default:o(()=>[l(N)]),_:1}),e[24]||(e[24]=q(" 保存配置 ",-1))]),_:1},8,["loading"]),l(M,{size:"large",onClick:R,loading:w.value,style:{width:"200px","margin-left":"20px"}},{default:o(()=>[l(m,null,{default:o(()=>[l(z)]),_:1}),e[25]||(e[25]=q(" 重新加载 ",-1))]),_:1},8,["loading"])]),l(I),l(A,{title:"配置说明",type:"info",closable:!1},{default:o(()=>[...e[26]||(e[26]=[s("ul",{style:{margin:"10px 0","padding-left":"20px","line-height":"1.8"}},[s("li",null,'修改配置后需要点击"保存配置"按钮'),s("li",null,"QQ邮箱授权码需要在QQ邮箱设置中开启SMTP服务后获取"),s("li",null,"建议先发送测试邮件验证配置是否正确")],-1)])]),_:1})]),_:1})]),_:1})]),_:1})])}}},ie=Y(te,[["__scopeId","data-v-a6269ce2"]]);export{ie as default};
