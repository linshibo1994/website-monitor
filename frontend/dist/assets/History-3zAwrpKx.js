import{r,o as X,a as _,b as u,d as e,w as t,e as o,i as H,B as Z,y as ee,m as d,A as I,j as p,l as te,t as n,p as f,C as ae}from"./index-XZi2pCr-.js";import{_ as le}from"./_plugin-vue_export-helper-DlAUqK2U.js";const oe={class:"history-page"},ne={class:"total-count"},se={class:"change-info"},de={key:0,class:"added"},ce={key:1,class:"removed"},ie={key:2,class:"no-change"},re={class:"pagination-wrapper"},ue={key:0},_e={class:"added"},pe={class:"removed"},me={key:0},ve={style:{color:"#67c23a","margin-bottom":"10px"}},fe={key:1,style:{"margin-top":"20px"}},ge={style:{color:"#f56c6c","margin-bottom":"10px"}},he={__name:"History",setup(ye){const B=r([]),z=r(!1),V=r(!1),F=r(0),g=r(1),S=r(20),h=r(null),b=r(!1),c=r(null),P=s=>s?H(s).format("YYYY-MM-DD HH:mm:ss"):"-",k=async()=>{z.value=!0;try{const s={page:g.value,page_size:S.value};h.value&&(s.start_date=H(h.value[0]).toISOString(),s.end_date=H(h.value[1]).endOf("day").toISOString());const l=await Z(s);B.value=l.data.items,F.value=l.data.total}catch(s){console.error("获取历史记录失败:",s)}finally{z.value=!1}},U=()=>{g.value=1,k()},M=()=>{g.value=1,k()},O=()=>{k()},R=async s=>{b.value=!0,V.value=!0;try{const l=await ae(s.id);c.value=l.data}catch(l){console.error("获取详情失败:",l)}finally{V.value=!1}},A=s=>{s&&window.open(s,"_blank")};return X(()=>{k()}),(s,l)=>{const E=o("el-date-picker"),$=o("el-col"),L=o("Search"),C=o("el-icon"),w=o("el-button"),T=o("el-row"),N=o("el-card"),i=o("el-table-column"),Y=o("el-tag"),q=o("View"),D=o("el-table"),G=o("el-pagination"),x=o("el-descriptions-item"),J=o("el-descriptions"),K=o("CirclePlus"),Q=o("RemoveFilled"),W=o("el-dialog"),j=ee("loading");return u(),_("div",oe,[e(N,{class:"filter-card"},{default:t(()=>[e(T,{gutter:20},{default:t(()=>[e($,{span:8},{default:t(()=>[e(E,{modelValue:h.value,"onUpdate:modelValue":l[0]||(l[0]=a=>h.value=a),type:"daterange","range-separator":"至","start-placeholder":"开始日期","end-placeholder":"结束日期",onChange:U},null,8,["modelValue"])]),_:1}),e($,{span:4},{default:t(()=>[e(w,{type:"primary",onClick:U},{default:t(()=>[e(C,null,{default:t(()=>[e(L)]),_:1}),l[5]||(l[5]=d(" 查询 ",-1))]),_:1})]),_:1})]),_:1})]),_:1}),e(N,{class:"table-card"},{default:t(()=>[I((u(),te(D,{data:B.value,stripe:"",style:{width:"100%"}},{default:t(()=>[e(i,{label:"检测时间",width:"180"},{default:t(({row:a})=>[d(n(P(a.check_time)),1)]),_:1}),e(i,{label:"商品总数",width:"120"},{default:t(({row:a})=>[p("span",ne,n(a.total_count),1)]),_:1}),e(i,{label:"变化",width:"150"},{default:t(({row:a})=>[p("div",se,[a.added_count>0?(u(),_("span",de," +"+n(a.added_count),1)):f("",!0),a.removed_count>0?(u(),_("span",ce," -"+n(a.removed_count),1)):f("",!0),a.added_count===0&&a.removed_count===0?(u(),_("span",ie," 无变化 ")):f("",!0)])]),_:1}),e(i,{prop:"detection_method",label:"检测方法",width:"150"},{default:t(({row:a})=>[e(Y,{size:"small"},{default:t(()=>[d(n(a.detection_method||"未知"),1)]),_:2},1024)]),_:1}),e(i,{label:"状态",width:"100"},{default:t(({row:a})=>[e(Y,{type:a.status==="success"?"success":"danger",size:"small"},{default:t(()=>[d(n(a.status==="success"?"成功":"失败"),1)]),_:2},1032,["type"])]),_:1}),e(i,{label:"耗时",width:"100"},{default:t(({row:a})=>{var m;return[d(n(((m=a.duration_seconds)==null?void 0:m.toFixed(2))||"-")+"秒 ",1)]}),_:1}),e(i,{label:"操作",width:"120",fixed:"right"},{default:t(({row:a})=>[e(w,{type:"primary",link:"",onClick:m=>R(a),disabled:a.added_count===0&&a.removed_count===0},{default:t(()=>[e(C,null,{default:t(()=>[e(q)]),_:1}),l[6]||(l[6]=d(" 详情 ",-1))]),_:1},8,["onClick","disabled"])]),_:1})]),_:1},8,["data"])),[[j,z.value]]),p("div",re,[e(G,{"current-page":g.value,"onUpdate:currentPage":l[1]||(l[1]=a=>g.value=a),"page-size":S.value,"onUpdate:pageSize":l[2]||(l[2]=a=>S.value=a),"page-sizes":[20,50,100],total:F.value,layout:"total, sizes, prev, pager, next, jumper",onSizeChange:M,onCurrentChange:O},null,8,["current-page","page-size","total"])])]),_:1}),e(W,{modelValue:b.value,"onUpdate:modelValue":l[4]||(l[4]=a=>b.value=a),title:"变化详情",width:"700px"},{footer:t(()=>[e(w,{onClick:l[3]||(l[3]=a=>b.value=!1)},{default:t(()=>[...l[8]||(l[8]=[d("关闭",-1)])]),_:1})]),default:t(()=>{var a,m;return[c.value?I((u(),_("div",ue,[e(J,{column:2,border:"",style:{"margin-bottom":"20px"}},{default:t(()=>[e(x,{label:"检测时间"},{default:t(()=>[d(n(P(c.value.check_time)),1)]),_:1}),e(x,{label:"商品总数"},{default:t(()=>[d(n(c.value.total_count),1)]),_:1}),e(x,{label:"新增数量"},{default:t(()=>[p("span",_e,"+"+n(c.value.added_count),1)]),_:1}),e(x,{label:"下架数量"},{default:t(()=>[p("span",pe,"-"+n(c.value.removed_count),1)]),_:1})]),_:1}),((a=c.value.added_products)==null?void 0:a.length)>0?(u(),_("div",me,[p("h4",ve,[e(C,null,{default:t(()=>[e(K)]),_:1}),d(" 新增商品 ("+n(c.value.added_products.length)+") ",1)]),e(D,{data:c.value.added_products,size:"small",border:""},{default:t(()=>[e(i,{prop:"product_name",label:"商品名称"}),e(i,{label:"价格",width:"100"},{default:t(({row:y})=>{var v;return[d(" $"+n(((v=y.product_price)==null?void 0:v.toFixed(2))||"未知"),1)]}),_:1}),e(i,{label:"操作",width:"80"},{default:t(({row:y})=>[e(w,{type:"primary",link:"",size:"small",onClick:v=>A(y.product_url)},{default:t(()=>[...l[7]||(l[7]=[d(" 查看 ",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"])])):f("",!0),((m=c.value.removed_products)==null?void 0:m.length)>0?(u(),_("div",fe,[p("h4",ge,[e(C,null,{default:t(()=>[e(Q)]),_:1}),d(" 下架商品 ("+n(c.value.removed_products.length)+") ",1)]),e(D,{data:c.value.removed_products,size:"small",border:""},{default:t(()=>[e(i,{prop:"product_name",label:"商品名称"}),e(i,{label:"价格",width:"100"},{default:t(({row:y})=>{var v;return[d(" $"+n(((v=y.product_price)==null?void 0:v.toFixed(2))||"未知"),1)]}),_:1})]),_:1},8,["data"])])):f("",!0)])),[[j,V.value]]):f("",!0)]}),_:1},8,["modelValue"])])}}},Ce=le(he,[["__scopeId","data-v-83a65547"]]);export{Ce as default};
